<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>PARADISE CASINO</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
body{background:#0a0a12;color:#fff;font-family:'Orbitron',monospace;overflow:hidden;height:100vh;user-select:none;-webkit-user-select:none}

/* â”€â”€ SPLASH â”€â”€ */
#splash{position:fixed;inset:0;z-index:999;background:linear-gradient(180deg,#0a0a12,#1a0a2e);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:opacity 1s}
#splash.hidden{opacity:0;pointer-events:none}
#splash h1{font-size:42px;letter-spacing:10px;background:linear-gradient(180deg,#ffd700,#ff6600);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
#splash h2{font-size:14px;color:#666;letter-spacing:8px;margin-bottom:40px}
#splash .tap{font-size:11px;color:#333;letter-spacing:4px;animation:pulse 2s ease infinite}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}

/* â”€â”€ TOPBAR â”€â”€ */
#topbar{height:50px;background:linear-gradient(90deg,#12121e,#1a1a2e,#12121e);border-bottom:1px solid #ffd70033;display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:10;position:relative}
#topbar .logo{font-size:12px;letter-spacing:4px;color:#ffd700}
#topbar .bal{display:flex;align-items:center;gap:6px;background:#ffd70011;border:1px solid #ffd70033;padding:4px 14px;border-radius:20px;font-size:13px;color:#ffd700}
#topbar .bal .coin{font-size:16px}
#topbar .back-btn{background:none;border:1px solid #333;color:#888;padding:4px 10px;font-family:inherit;font-size:10px;cursor:pointer;letter-spacing:2px;border-radius:4px;display:none}
#topbar .back-btn:hover{border-color:#ffd700;color:#ffd700}

/* â”€â”€ LOBBY â”€â”€ */
#lobby{display:flex;flex-direction:column;align-items:center;justify-content:center;height:calc(100vh - 50px);gap:20px;padding:20px}
#lobby h2{font-size:16px;letter-spacing:6px;color:#ffd70088;margin-bottom:10px}
.game-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;width:100%;max-width:500px}
.game-card{background:linear-gradient(135deg,#1a1a2e,#12121e);border:1px solid #333;border-radius:12px;padding:24px 16px;text-align:center;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
.game-card:hover{border-color:#ffd700;transform:translateY(-2px);box-shadow:0 8px 30px #ffd70022}
.game-card .icon{font-size:40px;margin-bottom:10px}
.game-card .gname{font-size:11px;letter-spacing:3px;color:#ddd;margin-bottom:4px}
.game-card .gdesc{font-size:8px;color:#666;letter-spacing:1px}
.game-card::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,#ffd70008,transparent);transition:left .5s}
.game-card:hover::after{left:100%}

/* â”€â”€ GAME SCREENS â”€â”€ */
.game-screen{display:none;flex-direction:column;height:calc(100vh - 50px);position:relative}
.game-screen.active{display:flex}

/* â”€â”€ SLOTS â”€â”€ */
#slots-game{align-items:center;justify-content:center;gap:20px;background:radial-gradient(ellipse at 50% 30%,#1a1030,#0a0a12)}
.slot-machine{display:flex;gap:8px;background:#0a0a14;border:2px solid #ffd70044;border-radius:16px;padding:20px 24px;position:relative}
.reel-window{width:70px;height:80px;overflow:hidden;border-radius:8px;background:#111;border:1px solid #ffd70022;position:relative}
.reel{transition:transform .3s;display:flex;flex-direction:column;align-items:center}
.reel .sym{width:70px;height:80px;display:flex;align-items:center;justify-content:center;font-size:36px}
.slot-line{position:absolute;left:0;right:0;top:50%;height:2px;background:#ffd70066;transform:translateY(-50%);pointer-events:none;z-index:2}
.slot-controls{display:flex;gap:10px;align-items:center}
.slot-controls input{width:100px;background:#111;border:1px solid #ffd70033;color:#ffd700;padding:8px;font-family:inherit;font-size:12px;text-align:center;border-radius:6px}
.spin-btn{background:linear-gradient(180deg,#ffd700,#ff8800);color:#000;border:none;padding:12px 32px;font-family:inherit;font-size:13px;font-weight:900;letter-spacing:3px;cursor:pointer;border-radius:8px;transition:all .2s}
.spin-btn:hover{transform:scale(1.05);box-shadow:0 0 20px #ffd70066}
.spin-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.slot-result{font-size:14px;letter-spacing:2px;min-height:24px;color:#ffd700}
.slot-pays{font-size:8px;color:#555;text-align:center;line-height:1.6;max-width:380px}

/* â”€â”€ CRASH â”€â”€ */
#crash-game{align-items:center;justify-content:center;gap:16px;background:radial-gradient(ellipse at 50% 80%,#0a1a0a,#0a0a12)}
.crash-display{width:90%;max-width:500px;height:250px;background:#0a0f0a;border:1px solid #00ff4433;border-radius:12px;position:relative;overflow:hidden}
.crash-canvas{width:100%;height:100%}
.crash-multi{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:#00ff44;text-shadow:0 0 30px #00ff4444;transition:color .3s}
.crash-multi.crashed{color:#ff0044;text-shadow:0 0 30px #ff004444}
.crash-controls{display:flex;gap:10px;align-items:center}
.crash-controls input{width:90px;background:#111;border:1px solid #00ff4433;color:#00ff44;padding:8px;font-family:inherit;font-size:12px;text-align:center;border-radius:6px}
.crash-btn{background:linear-gradient(180deg,#00ff44,#00aa22);color:#000;border:none;padding:10px 24px;font-family:inherit;font-size:12px;font-weight:900;letter-spacing:2px;cursor:pointer;border-radius:8px;transition:all .2s}
.crash-btn:hover{transform:scale(1.05)}
.crash-btn.cashout{background:linear-gradient(180deg,#ffd700,#ff8800)}
.crash-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.crash-history{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;max-width:500px}
.crash-history span{font-size:10px;padding:2px 8px;border-radius:10px;border:1px solid}
.crash-history .green{color:#00ff44;border-color:#00ff4444}
.crash-history .red{color:#ff0044;border-color:#ff004444}

/* â”€â”€ ROULETTE â”€â”€ */
#roulette-game{align-items:center;justify-content:center;gap:16px;background:radial-gradient(ellipse at 50% 30%,#1a0a0a,#0a0a12)}
.roulette-wheel{width:220px;height:220px;border-radius:50%;border:3px solid #ffd70066;position:relative;transition:transform 4s cubic-bezier(.2,.8,.3,1)}
.roulette-pointer{position:absolute;top:-14px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:18px solid #ffd700;z-index:5}
.roulette-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border-radius:50%;background:#111;border:2px solid #ffd700;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;color:#ffd700;z-index:3}
.roulette-bets{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;max-width:400px}
.roulette-bets button{padding:8px 16px;border-radius:6px;border:1px solid #444;background:#111;color:#fff;font-family:inherit;font-size:10px;letter-spacing:1px;cursor:pointer;transition:all .2s}
.roulette-bets button:hover{border-color:#ffd700}
.roulette-bets button.selected{border-color:#ffd700;background:#ffd70022;color:#ffd700}
.roulette-bets .red-btn{border-color:#ff004444;color:#ff4444}
.roulette-bets .red-btn.selected{background:#ff004422;border-color:#ff0044}
.roulette-bets .black-btn{border-color:#ffffff22;color:#aaa}
.roulette-bets .black-btn.selected{background:#ffffff11;border-color:#fff}
.roulette-bets .green-btn{border-color:#00ff4422;color:#00ff44}
.roulette-bets .green-btn.selected{background:#00ff4422;border-color:#00ff44}
.roulette-result{font-size:14px;min-height:24px;letter-spacing:2px}

/* â”€â”€ CASES â”€â”€ */
#cases-game{align-items:center;justify-content:center;gap:16px;background:radial-gradient(ellipse at 50% 50%,#1a1a0a,#0a0a12)}
.case-selector{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.case-card{width:100px;height:120px;border:2px solid #333;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;cursor:pointer;transition:all .3s;background:#111}
.case-card:hover{border-color:#ffd700;transform:translateY(-3px)}
.case-card.selected{border-color:#ffd700;box-shadow:0 0 20px #ffd70033}
.case-card .cicon{font-size:32px}
.case-card .cprice{font-size:10px;color:#ffd700}
.case-card .cname{font-size:8px;color:#888;letter-spacing:1px}
.case-spinner-wrap{width:90%;max-width:600px;height:100px;overflow:hidden;border-radius:10px;border:2px solid #ffd70044;position:relative;background:#0a0a14}
.case-spinner{display:flex;transition:transform 4s cubic-bezier(.2,.8,.3,1);position:absolute;top:0;left:0}
.case-spinner .item{width:100px;height:100px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;border-right:1px solid #222;flex-shrink:0}
.case-spinner .item .iemoji{font-size:28px}
.case-spinner .item .iname{font-size:7px;color:#888;text-align:center;max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.case-pointer{position:absolute;top:0;left:50%;transform:translateX(-50%);width:2px;height:100%;background:#ffd700;z-index:5}
.case-pointer::before{content:'â–¼';position:absolute;top:-14px;left:50%;transform:translateX(-50%);color:#ffd700;font-size:12px}
.case-result{font-size:14px;min-height:24px;letter-spacing:2px}
.open-btn{background:linear-gradient(180deg,#ffd700,#ff8800);color:#000;border:none;padding:10px 28px;font-family:inherit;font-size:12px;font-weight:900;letter-spacing:2px;cursor:pointer;border-radius:8px;transition:all .2s}
.open-btn:hover{transform:scale(1.05)}
.open-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

/* Rarity colors */
.rarity-common{color:#aaa;border-color:#aaa!important}
.rarity-uncommon{color:#4488ff;border-color:#4488ff!important}
.rarity-rare{color:#aa44ff;border-color:#aa44ff!important}
.rarity-epic{color:#ff44aa;border-color:#ff44aa!important}
.rarity-legendary{color:#ffd700;border-color:#ffd700!important}

/* â”€â”€ INVENTORY â”€â”€ */
.inv-btn{position:absolute;bottom:12px;right:12px;background:#111;border:1px solid #333;color:#888;padding:6px 14px;font-family:inherit;font-size:9px;letter-spacing:2px;cursor:pointer;border-radius:6px}
.inv-btn:hover{border-color:#ffd700;color:#ffd700}
#inventory{display:none;position:fixed;inset:0;z-index:100;background:#0a0a12ee;flex-direction:column;align-items:center;padding:60px 20px 20px;overflow-y:auto}
#inventory.active{display:flex}
#inventory h3{font-size:14px;letter-spacing:4px;color:#ffd700;margin-bottom:16px}
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;width:100%;max-width:600px}
.inv-item{background:#111;border:1px solid #333;border-radius:8px;padding:10px 6px;text-align:center;font-size:8px;display:flex;flex-direction:column;align-items:center;gap:4px}
.inv-item .ie{font-size:24px}
.inv-close{position:absolute;top:16px;right:20px;background:none;border:none;color:#666;font-size:24px;cursor:pointer}
.inv-close:hover{color:#fff}

/* â”€â”€ WIN POPUP â”€â”€ */
.win-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);z-index:200;background:radial-gradient(ellipse,#1a1a2e,#0a0a14);border:2px solid #ffd700;border-radius:16px;padding:30px 50px;text-align:center;transition:transform .4s cubic-bezier(.2,1.2,.3,1);pointer-events:none}
.win-popup.show{transform:translate(-50%,-50%) scale(1);pointer-events:auto}
.win-popup .wamount{font-size:36px;font-weight:900;color:#ffd700;text-shadow:0 0 30px #ffd70044}
.win-popup .wlabel{font-size:10px;color:#888;letter-spacing:4px;margin-bottom:8px}

/* Mobile */
@media(max-width:500px){
  .game-grid{grid-template-columns:1fr 1fr;gap:10px}
  .game-card{padding:18px 10px}
  .game-card .icon{font-size:30px}
  .slot-machine{padding:14px 16px;gap:6px}
  .reel-window{width:55px;height:65px}
  .reel .sym{width:55px;height:65px;font-size:28px}
  .crash-display{height:200px}
  .crash-multi{font-size:36px}
}
</style>
</head>
<body>

<div id="splash"><h1>PARADISE</h1><h2>CASINO</h2><div class="tap">TAP TO ENTER</div></div>

<div id="topbar" style="display:none">
  <button class="back-btn" id="backBtn" onclick="showLobby()">â† LOBBY</button>
  <div class="logo">PARADISE</div>
  <div class="bal"><span class="coin">ğŸ’°</span><span id="balDisplay">1,000</span></div>
</div>

<div id="lobby" style="display:none">
  <h2>SELECT GAME</h2>
  <div class="game-grid">
    <div class="game-card" onclick="openGame('slots')"><div class="icon">ğŸ°</div><div class="gname">SLOTS</div><div class="gdesc">SPIN TO WIN BIG</div></div>
    <div class="game-card" onclick="openGame('crash')"><div class="icon">ğŸ“ˆ</div><div class="gname">CRASH</div><div class="gdesc">CASH OUT IN TIME</div></div>
    <div class="game-card" onclick="openGame('roulette')"><div class="icon">ğŸ¡</div><div class="gname">ROULETTE</div><div class="gdesc">RED OR BLACK</div></div>
    <div class="game-card" onclick="openGame('cases')"><div class="icon">ğŸ“¦</div><div class="gname">CASES</div><div class="gdesc">OPEN FOR LOOT</div></div>
  </div>
</div>

<!-- SLOTS -->
<div id="slots-game" class="game-screen">
  <div class="slot-machine">
    <div class="slot-line"></div>
    <div class="reel-window"><div class="reel" id="reel0"></div></div>
    <div class="reel-window"><div class="reel" id="reel1"></div></div>
    <div class="reel-window"><div class="reel" id="reel2"></div></div>
    <div class="reel-window"><div class="reel" id="reel3"></div></div>
    <div class="reel-window"><div class="reel" id="reel4"></div></div>
  </div>
  <div class="slot-result" id="slotResult"></div>
  <div class="slot-controls">
    <input type="number" id="slotBet" value="10" min="1" placeholder="BET">
    <button class="spin-btn" id="spinBtn" onclick="spin()">SPIN</button>
  </div>
  <div class="slot-pays">ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ = 50x &nbsp;|&nbsp; 7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£ = 25x &nbsp;|&nbsp; ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’ = 15x<br>4 match = 5x &nbsp;|&nbsp; 3 match = 2x &nbsp;|&nbsp; 2ğŸ’ = 1x</div>
</div>

<!-- CRASH -->
<div id="crash-game" class="game-screen">
  <div class="crash-display">
    <canvas class="crash-canvas" id="crashCanvas"></canvas>
    <div class="crash-multi" id="crashMulti">1.00x</div>
  </div>
  <div class="crash-controls">
    <input type="number" id="crashBet" value="10" min="1" placeholder="BET">
    <button class="crash-btn" id="crashBtn" onclick="crashAction()">PLACE BET</button>
  </div>
  <div class="crash-history" id="crashHistory"></div>
</div>

<!-- ROULETTE -->
<div id="roulette-game" class="game-screen">
  <div style="position:relative;display:inline-block">
    <div class="roulette-pointer"></div>
    <canvas id="rouletteWheel" width="220" height="220" style="border-radius:50%;border:3px solid #ffd70066"></canvas>
    <div class="roulette-center" id="rouletteNum">â€”</div>
  </div>
  <div class="roulette-bets">
    <button class="red-btn" onclick="selectRBet('red')" id="rbet-red">ğŸ”´ RED</button>
    <button class="black-btn" onclick="selectRBet('black')" id="rbet-black">âš« BLACK</button>
    <button class="green-btn" onclick="selectRBet('green')" id="rbet-green">ğŸŸ¢ 0</button>
  </div>
  <div class="slot-controls">
    <input type="number" id="rouletteBet" value="10" min="1" placeholder="BET">
    <button class="spin-btn" id="rouletteBtn" onclick="spinRoulette()">SPIN</button>
  </div>
  <div class="roulette-result" id="rouletteResult"></div>
</div>

<!-- CASES -->
<div id="cases-game" class="game-screen">
  <div class="case-selector" id="caseSelector"></div>
  <div class="case-spinner-wrap" id="spinnerWrap" style="display:none">
    <div class="case-pointer"></div>
    <div class="case-spinner" id="caseSpinner"></div>
  </div>
  <div class="case-result" id="caseResult"></div>
  <div class="slot-controls">
    <button class="open-btn" id="openCaseBtn" onclick="openCase()">OPEN â€” $50</button>
  </div>
  <button class="inv-btn" onclick="showInventory()">INVENTORY</button>
</div>

<!-- INVENTORY -->
<div id="inventory">
  <button class="inv-close" onclick="hideInventory()">Ã—</button>
  <h3>INVENTORY</h3>
  <div class="inv-grid" id="invGrid"></div>
</div>

<!-- WIN POPUP -->
<div class="win-popup" id="winPopup">
  <div class="wlabel">YOU WON</div>
  <div class="wamount" id="winAmount">$0</div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let balance = parseInt(localStorage.getItem('casino_bal')) || 1000;
let inventory = JSON.parse(localStorage.getItem('casino_inv') || '[]');
const saveState = () => { localStorage.setItem('casino_bal', balance); localStorage.setItem('casino_inv', JSON.stringify(inventory)); };
const updateBal = () => { document.getElementById('balDisplay').textContent = balance.toLocaleString(); saveState(); };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let actx = null;
function ac() { if(!actx) actx = new (window.AudioContext||window.webkitAudioContext)(); if(actx.state==='suspended') actx.resume(); return actx; }

function sfx(type) {
  const ctx = ac();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.connect(g); g.connect(ctx.destination);
  if (type === 'tick') { o.frequency.value=800; g.gain.value=0.05; o.start(); o.stop(ctx.currentTime+0.03); }
  else if (type === 'win') { o.type='sine'; o.frequency.setValueAtTime(523,ctx.currentTime); o.frequency.setValueAtTime(659,ctx.currentTime+0.1); o.frequency.setValueAtTime(784,ctx.currentTime+0.2); g.gain.setValueAtTime(0.15,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.4); o.start(); o.stop(ctx.currentTime+0.4); }
  else if (type === 'lose') { o.type='sawtooth'; o.frequency.setValueAtTime(200,ctx.currentTime); o.frequency.exponentialRampToValueAtTime(80,ctx.currentTime+0.3); g.gain.setValueAtTime(0.08,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3); o.start(); o.stop(ctx.currentTime+0.35); }
  else if (type === 'bigwin') {
    [523,659,784,1047].forEach((f,i) => {
      const o2=ctx.createOscillator(), g2=ctx.createGain();
      o2.connect(g2); g2.connect(ctx.destination);
      o2.frequency.value=f; g2.gain.setValueAtTime(0.12,ctx.currentTime+i*0.12);
      g2.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+i*0.12+0.3);
      o2.start(ctx.currentTime+i*0.12); o2.stop(ctx.currentTime+i*0.12+0.35);
    });
    o.frequency.value=1;g.gain.value=0;o.start();o.stop(ctx.currentTime+0.01);
  }
  else if (type === 'crash') { o.type='sawtooth'; o.frequency.setValueAtTime(400,ctx.currentTime); o.frequency.exponentialRampToValueAtTime(40,ctx.currentTime+0.5); g.gain.setValueAtTime(0.2,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.5); o.start(); o.stop(ctx.currentTime+0.55); }
  else if (type === 'cashout') { o.type='sine'; o.frequency.value=1200; g.gain.setValueAtTime(0.1,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.15); o.start(); o.stop(ctx.currentTime+0.2); }
  else if (type === 'caseopen') { o.type='triangle'; o.frequency.setValueAtTime(300,ctx.currentTime); o.frequency.linearRampToValueAtTime(1200,ctx.currentTime+0.3); g.gain.setValueAtTime(0.08,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.35); o.start(); o.stop(ctx.currentTime+0.4); }
}

function showWin(amount) {
  const el = document.getElementById('winPopup');
  document.getElementById('winAmount').textContent = '$' + amount.toLocaleString();
  el.classList.add('show');
  if (amount > 500) sfx('bigwin'); else sfx('win');
  setTimeout(() => el.classList.remove('show'), 1800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLobby() {
  document.querySelectorAll('.game-screen').forEach(g => g.classList.remove('active'));
  document.getElementById('lobby').style.display = 'flex';
  document.getElementById('backBtn').style.display = 'none';
}

function openGame(id) {
  document.getElementById('lobby').style.display = 'none';
  document.querySelectorAll('.game-screen').forEach(g => g.classList.remove('active'));
  document.getElementById(id + '-game').classList.add('active');
  document.getElementById('backBtn').style.display = 'block';
  if (id === 'crash') initCrashCanvas();
  if (id === 'roulette') drawRouletteWheel(0);
  if (id === 'cases') renderCases();
}

// SPLASH
document.getElementById('splash').addEventListener('click', () => {
  document.getElementById('splash').classList.add('hidden');
  document.getElementById('topbar').style.display = 'flex';
  document.getElementById('lobby').style.display = 'flex';
  updateBal();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SLOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SYMS = ['ğŸ’','ğŸ‹','ğŸ””','â­','7ï¸âƒ£','ğŸ’','ğŸ‡','ğŸŠ'];
const SYM_WEIGHTS = [25,20,18,15,10,5,20,17]; // lower weight = rarer
let spinning = false;

function weightedSym() {
  const total = SYM_WEIGHTS.reduce((a,b)=>a+b,0);
  let r = Math.random()*total, acc=0;
  for(let i=0;i<SYMS.length;i++){acc+=SYM_WEIGHTS[i];if(r<acc)return SYMS[i];}
  return SYMS[0];
}

function initReels() {
  for(let i=0;i<5;i++){
    const reel=document.getElementById('reel'+i);
    reel.innerHTML='';
    const s=weightedSym();
    reel.innerHTML=`<div class="sym">${s}</div>`;
    reel.dataset.sym=s;
  }
}
initReels();

function spin() {
  if(spinning) return;
  const bet=parseInt(document.getElementById('slotBet').value)||10;
  if(bet>balance){document.getElementById('slotResult').textContent='NOT ENOUGH ğŸ’°';return;}
  if(bet<1) return;
  spinning=true;
  balance-=bet; updateBal();
  document.getElementById('spinBtn').disabled=true;
  document.getElementById('slotResult').textContent='';

  // Generate results
  const results=[];
  for(let i=0;i<5;i++) results.push(weightedSym());

  // Animate each reel with delay
  for(let i=0;i<5;i++){
    const reel=document.getElementById('reel'+i);
    let ticks=15+i*5;
    let t=0;
    const iv=setInterval(()=>{
      const s=weightedSym();
      reel.innerHTML=`<div class="sym">${s}</div>`;
      sfx('tick');
      t++;
      if(t>=ticks){
        clearInterval(iv);
        reel.innerHTML=`<div class="sym">${results[i]}</div>`;
        reel.dataset.sym=results[i];
        if(i===4) resolveSlots(results, bet);
      }
    }, 60+i*15);
  }
}

function resolveSlots(results, bet) {
  // Count matches
  const counts={};
  results.forEach(s=>{counts[s]=(counts[s]||0)+1;});
  const maxCount=Math.max(...Object.values(counts));
  const maxSym=Object.keys(counts).find(k=>counts[k]===maxCount);

  let multi=0;
  if(maxCount===5){
    if(maxSym==='ğŸ’') multi=50;
    else if(maxSym==='7ï¸âƒ£') multi=25;
    else if(maxSym==='ğŸ’') multi=15;
    else multi=10;
  } else if(maxCount===4) multi=5;
  else if(maxCount===3) multi=2;
  else if(maxCount===2 && maxSym==='ğŸ’') multi=1;

  if(multi>0){
    const winnings=bet*multi;
    balance+=winnings; updateBal();
    document.getElementById('slotResult').textContent=`${maxSym.repeat(maxCount)} â€” ${multi}x â€” +$${winnings}`;
    if(winnings>=bet*10) showWin(winnings);
    else sfx('win');
  } else {
    document.getElementById('slotResult').textContent='NO WIN';
    sfx('lose');
  }
  spinning=false;
  document.getElementById('spinBtn').disabled=false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CRASH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let crashState = 'idle'; // idle, betting, flying, crashed
let crashMultiplier = 1;
let crashTarget = 1;
let crashBetAmount = 0;
let crashPoints = [];
let crashAnimId = null;

function initCrashCanvas() {
  const canvas = document.getElementById('crashCanvas');
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}

function generateCrashPoint() {
  // House edge ~5%. Exponential distribution.
  const r = Math.random();
  if (r < 0.03) return 1.0; // instant crash 3%
  return Math.max(1, 1 / (1 - r) * 0.97);
}

function crashAction() {
  const btn = document.getElementById('crashBtn');
  if (crashState === 'idle') {
    const bet = parseInt(document.getElementById('crashBet').value) || 10;
    if (bet > balance) return;
    if (bet < 1) return;
    crashBetAmount = bet;
    balance -= bet; updateBal();
    crashTarget = generateCrashPoint();
    crashMultiplier = 1;
    crashPoints = [];
    crashState = 'flying';
    btn.textContent = 'CASH OUT';
    btn.className = 'crash-btn cashout';
    document.getElementById('crashMulti').className = 'crash-multi';
    startCrashFly();
  } else if (crashState === 'flying') {
    // Cash out
    const winnings = Math.floor(crashBetAmount * crashMultiplier);
    balance += winnings; updateBal();
    crashState = 'idle';
    btn.textContent = 'PLACE BET';
    btn.className = 'crash-btn';
    cancelAnimationFrame(crashAnimId);
    sfx('cashout');
    showWin(winnings);
    addCrashHistory(crashMultiplier, true);
  }
}

function startCrashFly() {
  const canvas = document.getElementById('crashCanvas');
  const ctx = canvas.getContext('2d');
  const startTime = Date.now();
  const multiEl = document.getElementById('crashMulti');

  function frame() {
    const elapsed = (Date.now() - startTime) / 1000;
    crashMultiplier = Math.pow(Math.E, elapsed * 0.5); // exponential growth

    if (crashMultiplier >= crashTarget) {
      // CRASHED
      crashMultiplier = crashTarget;
      crashState = 'crashed';
      multiEl.textContent = crashMultiplier.toFixed(2) + 'x';
      multiEl.className = 'crash-multi crashed';
      sfx('crash');
      addCrashHistory(crashTarget, false);
      const btn = document.getElementById('crashBtn');
      btn.textContent = 'PLACE BET';
      btn.className = 'crash-btn';
      setTimeout(() => { crashState = 'idle'; }, 1500);
      drawCrashGraph(ctx, canvas, true);
      return;
    }

    multiEl.textContent = crashMultiplier.toFixed(2) + 'x';
    crashPoints.push({ x: elapsed, y: crashMultiplier });
    drawCrashGraph(ctx, canvas, false);
    crashAnimId = requestAnimationFrame(frame);
  }
  frame();
}

function drawCrashGraph(ctx, canvas, crashed) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (crashPoints.length < 2) return;

  const maxX = crashPoints[crashPoints.length-1].x || 1;
  const maxY = Math.max(crashMultiplier, 2);

  ctx.beginPath();
  ctx.strokeStyle = crashed ? '#ff0044' : '#00ff44';
  ctx.lineWidth = 2;
  ctx.shadowColor = crashed ? '#ff0044' : '#00ff44';
  ctx.shadowBlur = 10;

  crashPoints.forEach((p, i) => {
    const x = (p.x / maxX) * (canvas.width - 20) + 10;
    const y = canvas.height - ((p.y - 1) / (maxY - 1)) * (canvas.height - 20) - 10;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.stroke();
  ctx.shadowBlur = 0;

  // Fill area under curve
  const lastP = crashPoints[crashPoints.length-1];
  const lastX = (lastP.x / maxX) * (canvas.width - 20) + 10;
  ctx.lineTo(lastX, canvas.height);
  ctx.lineTo(10, canvas.height);
  ctx.closePath();
  ctx.fillStyle = crashed ? 'rgba(255,0,68,0.05)' : 'rgba(0,255,68,0.05)';
  ctx.fill();
}

function addCrashHistory(multi, won) {
  const el = document.getElementById('crashHistory');
  const span = document.createElement('span');
  span.textContent = multi.toFixed(2) + 'x';
  span.className = won ? 'green' : 'red';
  el.prepend(span);
  if (el.children.length > 20) el.removeChild(el.lastChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROULETTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const R_NUMBERS = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const R_REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
let selectedRBet = null;
let rouletteSpinning = false;
let rAngle = 0;

function selectRBet(type) {
  selectedRBet = type;
  document.querySelectorAll('.roulette-bets button').forEach(b=>b.classList.remove('selected'));
  document.getElementById('rbet-'+type).classList.add('selected');
}

function drawRouletteWheel(rotAngle) {
  const canvas = document.getElementById('rouletteWheel');
  const ctx = canvas.getContext('2d');
  const cx = 110, cy = 110, r = 100;
  const sliceAngle = (Math.PI * 2) / R_NUMBERS.length;

  ctx.clearRect(0, 0, 220, 220);

  R_NUMBERS.forEach((num, i) => {
    const startA = rotAngle + i * sliceAngle - Math.PI/2;
    const endA = startA + sliceAngle;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, startA, endA);
    ctx.closePath();

    if (num === 0) ctx.fillStyle = '#00aa44';
    else if (R_REDS.includes(num)) ctx.fillStyle = '#cc1133';
    else ctx.fillStyle = '#1a1a2e';
    ctx.fill();
    ctx.strokeStyle = '#ffd70033';
    ctx.lineWidth = 0.5;
    ctx.stroke();

    // Number text
    const midA = startA + sliceAngle/2;
    const tx = cx + Math.cos(midA) * (r * 0.75);
    const ty = cy + Math.sin(midA) * (r * 0.75);
    ctx.save();
    ctx.translate(tx, ty);
    ctx.rotate(midA + Math.PI/2);
    ctx.fillStyle = '#fff';
    ctx.font = '9px Orbitron';
    ctx.textAlign = 'center';
    ctx.fillText(num.toString(), 0, 0);
    ctx.restore();
  });
}

function spinRoulette() {
  if (rouletteSpinning || !selectedRBet) return;
  const bet = parseInt(document.getElementById('rouletteBet').value) || 10;
  if (bet > balance || bet < 1) return;
  rouletteSpinning = true;
  balance -= bet; updateBal();
  document.getElementById('rouletteBtn').disabled = true;
  document.getElementById('rouletteResult').textContent = '';

  // Pick result
  const resultIdx = Math.floor(Math.random() * R_NUMBERS.length);
  const resultNum = R_NUMBERS[resultIdx];

  // Calculate target angle so the result lands at top (pointer)
  const sliceAngle = (Math.PI * 2) / R_NUMBERS.length;
  const targetAngle = -(resultIdx * sliceAngle) + Math.PI * 2 * (5 + Math.random()*3); // 5-8 full spins

  let current = rAngle;
  const startTime = Date.now();
  const duration = 4000;

  function animSpin() {
    const elapsed = Date.now() - startTime;
    const t = Math.min(elapsed / duration, 1);
    // Ease out cubic
    const ease = 1 - Math.pow(1 - t, 3);
    rAngle = current + (targetAngle - current) * ease;
    drawRouletteWheel(rAngle);

    if (t < 1) {
      requestAnimationFrame(animSpin);
    } else {
      rAngle = targetAngle;
      resolveRoulette(resultNum, bet);
    }
  }
  animSpin();
}

function resolveRoulette(num, bet) {
  const isRed = R_REDS.includes(num);
  const isGreen = num === 0;
  document.getElementById('rouletteNum').textContent = num;
  document.getElementById('rouletteNum').style.color = isGreen ? '#00ff44' : isRed ? '#ff0044' : '#fff';

  let won = false;
  let multi = 0;
  if (selectedRBet === 'red' && isRed) { won = true; multi = 2; }
  else if (selectedRBet === 'black' && !isRed && !isGreen) { won = true; multi = 2; }
  else if (selectedRBet === 'green' && isGreen) { won = true; multi = 14; }

  if (won) {
    const winnings = bet * multi;
    balance += winnings; updateBal();
    document.getElementById('rouletteResult').textContent = `${num} â€” ${multi}x â€” +$${winnings}`;
    document.getElementById('rouletteResult').style.color = '#ffd700';
    if (winnings >= 100) showWin(winnings); else sfx('win');
  } else {
    document.getElementById('rouletteResult').textContent = `${num} â€” NO WIN`;
    document.getElementById('rouletteResult').style.color = '#ff0044';
    sfx('lose');
  }

  rouletteSpinning = false;
  document.getElementById('rouletteBtn').disabled = false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CASES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CASES = [
  {
    name: 'BRONZE', price: 50, emoji: 'ğŸ“¦', items: [
      { name:'Rusty Coin', emoji:'ğŸª™', rarity:'common', value:5 },
      { name:'Stone', emoji:'ğŸª¨', rarity:'common', value:8 },
      { name:'Feather', emoji:'ğŸª¶', rarity:'common', value:10 },
      { name:'Old Key', emoji:'ğŸ—ï¸', rarity:'uncommon', value:25 },
      { name:'Silver Ring', emoji:'ğŸ’', rarity:'uncommon', value:40 },
      { name:'Ruby', emoji:'â¤ï¸â€ğŸ”¥', rarity:'rare', value:80 },
      { name:'Emerald', emoji:'ğŸ’š', rarity:'rare', value:120 },
      { name:'Gold Bar', emoji:'ğŸ¥‡', rarity:'epic', value:250 },
      { name:'Diamond', emoji:'ğŸ’', rarity:'legendary', value:500 },
    ]
  },
  {
    name: 'GOLD', price: 200, emoji: 'ğŸ', items: [
      { name:'Compass', emoji:'ğŸ§­', rarity:'common', value:20 },
      { name:'Map', emoji:'ğŸ—ºï¸', rarity:'common', value:30 },
      { name:'Telescope', emoji:'ğŸ”­', rarity:'uncommon', value:80 },
      { name:'Crown', emoji:'ğŸ‘‘', rarity:'uncommon', value:120 },
      { name:'Scepter', emoji:'ğŸ†', rarity:'rare', value:250 },
      { name:'Trident', emoji:'ğŸ”±', rarity:'rare', value:400 },
      { name:'Sacred Gem', emoji:'ğŸ’ ', rarity:'epic', value:800 },
      { name:'Dragon Egg', emoji:'ğŸ¥š', rarity:'epic', value:1200 },
      { name:'Infinity Stone', emoji:'â™¾ï¸', rarity:'legendary', value:2500 },
    ]
  },
  {
    name: 'DIAMOND', price: 500, emoji: 'ğŸ’', items: [
      { name:'Meteorite', emoji:'â˜„ï¸', rarity:'uncommon', value:100 },
      { name:'Phoenix', emoji:'ğŸ¦â€ğŸ”¥', rarity:'uncommon', value:200 },
      { name:'Blade', emoji:'âš”ï¸', rarity:'rare', value:500 },
      { name:'Throne', emoji:'ğŸª‘', rarity:'rare', value:800 },
      { name:'Enchanted Orb', emoji:'ğŸ”®', rarity:'epic', value:1500 },
      { name:'Ancient Relic', emoji:'âš±ï¸', rarity:'epic', value:2000 },
      { name:'Galaxy Core', emoji:'ğŸŒŒ', rarity:'legendary', value:5000 },
      { name:'Void Crystal', emoji:'âœ´ï¸', rarity:'legendary', value:8000 },
    ]
  },
];

const RARITY_WEIGHTS = { common:40, uncommon:30, rare:18, epic:8, legendary:4 };
let selectedCase = 0;
let caseOpening = false;

function renderCases() {
  const sel = document.getElementById('caseSelector');
  sel.innerHTML = '';
  CASES.forEach((c, i) => {
    const div = document.createElement('div');
    div.className = 'case-card' + (i === selectedCase ? ' selected' : '');
    div.innerHTML = `<div class="cicon">${c.emoji}</div><div class="cprice">$${c.price}</div><div class="cname">${c.name}</div>`;
    div.onclick = () => { selectedCase = i; renderCases(); };
    sel.appendChild(div);
  });
  document.getElementById('openCaseBtn').textContent = `OPEN â€” $${CASES[selectedCase].price}`;
}

function pickItem(caseData) {
  // Weighted by rarity
  const items = caseData.items;
  const weights = items.map(it => RARITY_WEIGHTS[it.rarity] || 10);
  const total = weights.reduce((a,b) => a+b, 0);
  let r = Math.random() * total, acc = 0;
  for (let i = 0; i < items.length; i++) {
    acc += weights[i];
    if (r < acc) return items[i];
  }
  return items[0];
}

function openCase() {
  if (caseOpening) return;
  const c = CASES[selectedCase];
  if (balance < c.price) return;
  caseOpening = true;
  balance -= c.price; updateBal();
  document.getElementById('openCaseBtn').disabled = true;
  document.getElementById('caseResult').textContent = '';
  document.getElementById('spinnerWrap').style.display = 'block';

  // Build spinner strip with 60 items, winner at position 50
  const winner = pickItem(c);
  const strip = [];
  for (let i = 0; i < 60; i++) {
    if (i === 50) strip.push(winner);
    else strip.push(pickItem(c));
  }

  const spinner = document.getElementById('caseSpinner');
  spinner.innerHTML = '';
  strip.forEach(item => {
    const div = document.createElement('div');
    div.className = 'item';
    const rarityClass = 'rarity-' + item.rarity;
    div.innerHTML = `<div class="iemoji">${item.emoji}</div><div class="iname ${rarityClass}">${item.name}</div>`;
    div.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('color') || '#333';
    spinner.appendChild(div);
  });

  // Calculate scroll: item 50 should align with center pointer
  const wrapWidth = document.getElementById('spinnerWrap').offsetWidth;
  const targetX = 50 * 100 + 50 - wrapWidth / 2; // center of item 50

  spinner.style.transition = 'none';
  spinner.style.transform = 'translateX(0)';
  sfx('caseopen');

  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      spinner.style.transition = 'transform 4s cubic-bezier(.2,.8,.3,1)';
      spinner.style.transform = `translateX(-${targetX}px)`;

      // Tick sounds during scroll
      let tickCount = 0;
      const tickIv = setInterval(() => {
        sfx('tick');
        tickCount++;
        if (tickCount > 40) clearInterval(tickIv);
      }, 80);

      setTimeout(() => {
        clearInterval(tickIv);
        // Reveal winner
        const rClass = 'rarity-' + winner.rarity;
        document.getElementById('caseResult').innerHTML =
          `<span class="${rClass}">${winner.emoji} ${winner.name} â€” $${winner.value}</span>`;

        inventory.push({ ...winner, date: Date.now() });
        balance += winner.value; updateBal();

        if (winner.rarity === 'legendary') showWin(winner.value);
        else if (winner.rarity === 'epic') sfx('bigwin');
        else sfx('win');

        caseOpening = false;
        document.getElementById('openCaseBtn').disabled = false;
      }, 4200);
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INVENTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showInventory() {
  const grid = document.getElementById('invGrid');
  grid.innerHTML = '';
  if (inventory.length === 0) {
    grid.innerHTML = '<div style="color:#555;font-size:10px;letter-spacing:2px;grid-column:1/-1;text-align:center;padding:40px">EMPTY â€” OPEN SOME CASES!</div>';
  } else {
    // Show newest first
    [...inventory].reverse().forEach(item => {
      const div = document.createElement('div');
      div.className = 'inv-item rarity-' + item.rarity;
      div.innerHTML = `<div class="ie">${item.emoji}</div><div>${item.name}</div><div style="color:#ffd700">$${item.value}</div>`;
      grid.appendChild(div);
    });
  }
  document.getElementById('inventory').classList.add('active');
}
function hideInventory() { document.getElementById('inventory').classList.remove('active'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FREE COINS (prevent going broke)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
setInterval(() => {
  if (balance < 10) {
    balance += 100;
    updateBal();
  }
}, 5000);

</script>
</body>
</html>
